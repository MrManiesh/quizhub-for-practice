<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QuizHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- React & DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons (React UMD) -->
    <script src="https://unpkg.com/lucide-react@0.469.0/dist/umd/lucide-react.js"></script>

    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #f3f4f6;
      }
      .animate-fade-in { animation: fadeIn 0.5s ease-out; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      .animate-bounce-short { animation: bounceShort 1s infinite; }
      @keyframes bounceShort { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(5px); } }
      
      .custom-scrollbar::-webkit-scrollbar { width: 6px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: #94a3b8; }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.1",
    "react-dom/": "https://esm.sh/react-dom@^19.2.1/",
    "react/": "https://esm.sh/react@^19.2.1/",
    "lucide-react": "https://esm.sh/lucide-react@^0.559.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-presets="typescript,react">
      const { useState, useEffect, useRef } = React;
      
      // --- ICONS ---
      const { 
        Settings, Play, Trophy, RotateCcw, User, Info, 
        CheckCircle, XCircle, ChevronRight, AlertCircle, Award,
        Upload, Save, Trash2, ArrowLeft, Lock, Key, LogOut, Clock, Calendar
      } = window.lucideReact || {};

      if (!window.lucideReact) {
         console.error("Lucide React library not loaded");
      }

      // --- TYPES & CONSTANTS ---
      
      const DEFAULT_APP_NAME = "QuizHub";

      const DEFAULT_QUIZ = {
        id: 'default-rajasthan-quiz',
        title: 'Rajasthan Folk Dance (Lok Nartya)',
        createdAt: Date.now(),
        questions: [
          {
            id: 'q1',
            text: "Ghoomar dance originally belongs to which community?",
            options: ["Rajput", "Bhil", "Meena", "Gurjar"],
            correctIndex: 1,
            explanation: "Ghoomar का मूल भील समुदाय है। बाद में राजपूतों ने इसे अपनाया और यह मेवाड़ क्षेत्र का प्रमुख लोक नृत्य बना।"
          },
          {
            id: 'q2',
            text: "Which Rajasthani dance is included in UNESCO’s Intangible Cultural Heritage list?",
            options: ["Chari", "Kalbeliya", "Gair", "Bhavai"],
            correctIndex: 1,
            explanation: "Kalbeliya (Sapera समुदाय का नृत्य) को 2010 में UNESCO Intangible Cultural Heritage सूची में शामिल किया गया।"
          },
          {
            id: 'q3',
            text: "Which dance involves balancing multiple pots (matkas) on the head?",
            options: ["Bhavai", "Terah Taal", "Chakri", "Chari"],
            correctIndex: 0,
            explanation: "Bhavai में महिलाएँ सिर पर कई मटके (8–11 या उससे अधिक) संतुलित करके नृत्य करती हैं, कभी तलवार या काँच पर भी।"
          },
          {
            id: 'q4',
            text: "Which Rajasthani dance uses 13 manjiras tied to the body?",
            options: ["Gair", "Kalbeliya", "Terah Taal", "Chari"],
            correctIndex: 2,
            explanation: "Terah Taal में शरीर पर 13 मंजीरे बाँधकर बैठकर लयबद्ध नृत्य किया जाता है।"
          },
          {
            id: 'q5',
            text: "Kachchi Ghodi dance is mainly associated with which region of Rajasthan?",
            options: ["Marwar", "Shekhawati", "Mewar", "Hadoti"],
            correctIndex: 1,
            explanation: "Kachchi Ghodi, नकली घोड़े की पोशाक वाला नृत्य, मुख्यतः शेखावाटी क्षेत्र से जुड़ा है।"
          }
        ]
      };

      // --- COMPONENTS ---

      const Button = ({ children, variant = 'primary', fullWidth = false, className = '', ...props }) => {
        const baseStyles = "px-6 py-3 rounded-xl font-medium transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:pointer-events-none flex items-center justify-center gap-2";
        const variants = {
          primary: "bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-500/30",
          secondary: "bg-gray-100 hover:bg-gray-200 text-gray-900",
          danger: "bg-red-500 hover:bg-red-600 text-white shadow-lg shadow-red-500/30",
          outline: "border-2 border-indigo-200 hover:border-indigo-600 hover:text-indigo-600 text-gray-500 bg-transparent"
        };
        const widthClass = fullWidth ? "w-full" : "";
        return (
          <button className={`${baseStyles} ${variants[variant]} ${widthClass} ${className}`} {...props}>
            {children}
          </button>
        );
      };

      const QuizPlayer = ({ quiz, username, onFinish, onExit }) => {
        const [currentIndex, setCurrentIndex] = useState(0);
        const [selectedOption, setSelectedOption] = useState(null);
        const [isAnswered, setIsAnswered] = useState(false);
        const [score, setScore] = useState(0);

        const currentQuestion = quiz.questions[currentIndex];
        const isLastQuestion = currentIndex === quiz.questions.length - 1;

        const handleOptionSelect = (index) => {
          if (isAnswered) return;
          setSelectedOption(index);
        };

        const handleSubmit = () => {
          if (selectedOption === null) return;
          setIsAnswered(true);
          if (selectedOption === currentQuestion.correctIndex) {
            setScore(prev => prev + 1);
          }
        };

        const handleNext = () => {
          if (isLastQuestion) {
            onFinish({
              username,
              score: score + (selectedOption === currentQuestion.correctIndex ? 0 : 0), 
              totalQuestions: quiz.questions.length,
              quizTitle: quiz.title,
              completedAt: new Date().toISOString()
            });
          } else {
            setCurrentIndex(prev => prev + 1);
            setSelectedOption(null);
            setIsAnswered(false);
          }
        };

        const progress = ((currentIndex) / quiz.questions.length) * 100;

        return (
          <div className="w-full max-w-3xl mx-auto">
            <div className="mb-6 flex items-center justify-between">
               <div className="flex flex-col">
                  <span className="text-xs font-bold text-indigo-600 uppercase tracking-wider mb-1">Playing as {username}</span>
                  <h2 className="text-xl font-bold text-gray-800">{quiz.title}</h2>
               </div>
               <div className="text-right">
                  <span className="text-2xl font-bold text-indigo-600">{currentIndex + 1}</span>
                  <span className="text-gray-400 font-medium">/{quiz.questions.length}</span>
               </div>
            </div>

            <div className="w-full h-2 bg-gray-200 rounded-full mb-8 overflow-hidden">
              <div className="h-full bg-indigo-500 transition-all duration-500 ease-out" style={{ width: `${progress}%` }} />
            </div>

            <div className="bg-white rounded-3xl shadow-xl shadow-indigo-100 p-6 md:p-10 mb-6 relative overflow-hidden">
              <div className="absolute top-0 right-0 w-32 h-32 bg-indigo-50 rounded-full -mr-16 -mt-16 z-0" />
              <h3 className="text-xl md:text-2xl font-bold text-gray-800 mb-8 relative z-10 leading-relaxed">
                {currentQuestion.text}
              </h3>

              <div className="space-y-3 relative z-10">
                {currentQuestion.options.map((option, idx) => {
                  let stateClasses = "border-gray-200 hover:border-indigo-300 hover:bg-indigo-50";
                  let icon = <div className="w-5 h-5 rounded-full border-2 border-gray-300" />;
                  
                  if (isAnswered) {
                    if (idx === currentQuestion.correctIndex) {
                      stateClasses = "border-green-500 bg-green-50 ring-1 ring-green-500";
                      icon = CheckCircle ? <CheckCircle className="text-green-500" size={20} /> : <span className="text-green-500 font-bold">✓</span>;
                    } else if (idx === selectedOption && idx !== currentQuestion.correctIndex) {
                      stateClasses = "border-red-500 bg-red-50 ring-1 ring-red-500";
                      icon = XCircle ? <XCircle className="text-red-500" size={20} /> : <span className="text-red-500 font-bold">✗</span>;
                    } else {
                      stateClasses = "border-gray-100 opacity-60";
                    }
                  } else if (selectedOption === idx) {
                    stateClasses = "border-indigo-600 bg-indigo-50 ring-1 ring-indigo-600";
                    icon = <div className="w-5 h-5 rounded-full border-[6px] border-indigo-600" />;
                  }

                  return (
                    <button
                      key={idx}
                      onClick={() => handleOptionSelect(idx)}
                      disabled={isAnswered}
                      className={`w-full p-4 text-left rounded-xl border-2 transition-all duration-200 flex items-center gap-4 ${stateClasses}`}
                    >
                      <div className="flex-shrink-0">{icon}</div>
                      <span className={`font-medium ${isAnswered && idx === currentQuestion.correctIndex ? 'text-green-700' : 'text-gray-700'}`}>
                        {option}
                      </span>
                    </button>
                  );
                })}
              </div>

              {isAnswered && (
                <div className="mt-8 p-4 bg-blue-50 border border-blue-100 rounded-xl relative z-10 animate-fade-in">
                  <div className="flex items-start gap-3">
                    {AlertCircle && <AlertCircle className="text-blue-600 shrink-0 mt-0.5" size={20} />}
                    <div>
                      <h4 className="font-bold text-blue-800 text-sm mb-1 uppercase">Explanation</h4>
                      <p className="text-blue-900 leading-relaxed text-sm md:text-base">{currentQuestion.explanation}</p>
                    </div>
                  </div>
                </div>
              )}
            </div>

            <div className="flex justify-between items-center">
              <button onClick={onExit} className="text-gray-400 hover:text-gray-600 font-medium px-4 py-2 transition-colors">Quit Quiz</button>
              {!isAnswered ? (
                <Button onClick={handleSubmit} disabled={selectedOption === null} className="w-32">Submit</Button>
              ) : (
                <Button onClick={handleNext} className="w-32 animate-bounce-short">
                  {isLastQuestion ? "Finish" : "Next"} {ChevronRight && <ChevronRight size={18} />}
                </Button>
              )}
            </div>
          </div>
        );
      };

      const AdminPanel = ({ appName, quizzes, history, onUpdateConfig, onAddQuiz, onDeleteQuiz, onBack }) => {
        const [isAuthenticated, setIsAuthenticated] = useState(false);
        const [username, setUsername] = useState('');
        const [password, setPassword] = useState('');
        const [authError, setAuthError] = useState('');
        const [editingName, setEditingName] = useState(appName);
        const [error, setError] = useState(null);
        const fileInputRef = useRef(null);

        const handleLogin = (e) => {
          e.preventDefault();
          if (username === 'admin' && password === 'Admin@123') {
            setIsAuthenticated(true);
            setAuthError('');
            setEditingName(appName);
          } else {
            setAuthError('Invalid username or password');
          }
        };

        const handleLogout = () => {
          setIsAuthenticated(false);
          setUsername('');
          setPassword('');
        };

        const handleSaveConfig = () => {
          if (!editingName.trim()) {
            setError("App Name cannot be empty");
            return;
          }
          onUpdateConfig({ appName: editingName });
          alert("App name updated!");
        };

        const handleFileUpload = (event) => {
          const file = event.target.files?.[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const json = JSON.parse(e.target.result);
              if (!json.title || !Array.isArray(json.questions)) throw new Error("Invalid JSON structure.");
              
              const newQuiz = {
                id: `quiz-${Date.now()}`,
                title: json.title,
                createdAt: Date.now(),
                questions: json.questions.map((q, idx) => ({
                  id: q.id || `q-${Date.now()}-${idx}`,
                  text: q.question || q.text,
                  options: q.options,
                  correctIndex: q.correctIndex,
                  explanation: q.explanation || "No explanation provided."
                }))
              };
              onAddQuiz(newQuiz);
              setError(null);
              alert(`Quiz "${newQuiz.title}" added successfully!`);
              if (fileInputRef.current) fileInputRef.current.value = '';
            } catch (err) {
              setError(err.message || "Failed to parse JSON file.");
            }
          };
          reader.readAsText(file);
        };

        // Group history by quiz title
        const groupedHistory = history.reduce((acc, session) => {
            const key = session.quizTitle || 'Unknown';
            if (!acc[key]) acc[key] = [];
            acc[key].push(session);
            return acc;
        }, {});

        if (!isAuthenticated) {
          return (
            <div className="max-w-md mx-auto w-full pt-6 md:pt-12">
               <div className="mb-6">
                  <Button variant="secondary" onClick={onBack} className="!px-3 mb-4">{ArrowLeft && <ArrowLeft size={20} />} Back to Home</Button>
               </div>
               <div className="bg-white p-8 rounded-3xl shadow-xl shadow-indigo-100 border border-gray-100">
                  <div className="text-center mb-8">
                      <div className="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">{Lock && <Lock size={32} />}</div>
                      <h2 className="text-2xl font-bold text-gray-800">Admin Login</h2>
                      <p className="text-gray-500 text-sm mt-2">Enter credentials to access dashboard</p>
                  </div>
                  <form onSubmit={handleLogin} className="space-y-4">
                      <div>
                          <label className="block text-sm font-bold text-gray-700 mb-2 ml-1">Username</label>
                          <div className="relative">
                              {User && <User className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" size={18} />}
                              <input type="text" value={username} onChange={(e) => setUsername(e.target.value)} className="w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Enter username" />
                          </div>
                      </div>
                      <div>
                          <label className="block text-sm font-bold text-gray-700 mb-2 ml-1">Password</label>
                          <div className="relative">
                              {Key && <Key className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" size={18} />}
                              <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Enter password" />
                          </div>
                      </div>
                      {authError && <div className="p-3 bg-red-50 text-red-600 text-sm rounded-lg text-center font-medium animate-pulse">{authError}</div>}
                      <Button type="submit" fullWidth className="mt-4">Login</Button>
                  </form>
               </div>
            </div>
          );
        }

        return (
          <div className="max-w-4xl mx-auto w-full pb-10">
            <div className="flex items-center justify-between mb-8">
              <div className="flex items-center gap-4">
                <Button variant="secondary" onClick={onBack} className="!px-3">{ArrowLeft && <ArrowLeft size={20} />}</Button>
                <h2 className="text-2xl font-bold text-gray-800">Admin Dashboard</h2>
              </div>
              <button onClick={handleLogout} className="flex items-center gap-2 text-red-500 font-medium hover:bg-red-50 px-4 py-2 rounded-lg transition-colors">{LogOut && <LogOut size={18} />} Logout</button>
            </div>
            
            <div className="grid gap-6">
              {/* Settings Card */}
              <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 className="text-lg font-semibold mb-4 text-gray-800">General Settings</h3>
                <div className="flex gap-4 items-end">
                  <div className="flex-1">
                    <label className="block text-sm font-medium text-gray-700 mb-1">App Name</label>
                    <input type="text" value={editingName} onChange={(e) => setEditingName(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none" />
                  </div>
                  <Button onClick={handleSaveConfig} className="mb-[1px]">{Save && <Save size={18} />} Save</Button>
                </div>
              </div>
              
              {/* Upload Card */}
              <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 className="text-lg font-semibold mb-4 text-gray-800">Add New Quiz</h3>
                <div className="border-2 border-dashed border-indigo-100 rounded-xl p-8 text-center bg-indigo-50/50 hover:bg-indigo-50 transition-colors">
                  <input type="file" ref={fileInputRef} accept=".json" onChange={handleFileUpload} className="hidden" id="file-upload" />
                  <label htmlFor="file-upload" className="cursor-pointer flex flex-col items-center">
                    <div className="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mb-3">{Upload && <Upload size={24} />}</div>
                    <span className="text-indigo-600 font-medium">Click to upload JSON file</span>
                    <p className="text-sm text-gray-500 mt-1">Format: {`{ "title": "...", "questions": [...] }`}</p>
                  </label>
                </div>
                {error && <div className="mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm border border-red-100">{error}</div>}
              </div>
              
              {/* Manage Quizzes Card */}
              <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 className="text-lg font-semibold mb-4 text-gray-800">Manage Quizzes ({quizzes.length})</h3>
                <div className="space-y-3">
                  {quizzes.length === 0 ? <p className="text-gray-400 italic">No quizzes available.</p> : quizzes.map(quiz => (
                    <div key={quiz.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100">
                      <div><h4 className="font-medium text-gray-900">{quiz.title}</h4><span className="text-xs text-gray-500">{quiz.questions.length} questions</span></div>
                      <button onClick={() => onDeleteQuiz(quiz.id)} className="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors" title="Delete Quiz">{Trash2 && <Trash2 size={18} />}</button>
                    </div>
                  ))}
                </div>
              </div>

              {/* Score History Card */}
              <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 className="text-lg font-semibold mb-4 text-gray-800">Score History</h3>
                {history.length === 0 ? <p className="text-gray-400 italic">No scores recorded yet.</p> : 
                    <div className="space-y-6">
                        {Object.entries(groupedHistory).map(([title, sessions]) => (
                            <div key={title} className="border border-gray-200 rounded-xl overflow-hidden">
                                <div className="bg-gray-50 px-4 py-3 border-b border-gray-200 flex justify-between items-center">
                                    <span className="font-bold text-gray-700">{title}</span>
                                    <span className="text-xs text-gray-500 bg-white px-2 py-1 rounded border">{sessions.length} attempts</span>
                                </div>
                                <div className="max-h-60 overflow-y-auto custom-scrollbar">
                                    <table className="w-full text-sm text-left">
                                        <thead className="bg-white text-gray-500 font-medium sticky top-0 z-10 shadow-sm">
                                            <tr>
                                                <th className="px-4 py-2 bg-gray-50 w-40">Date & Time</th>
                                                <th className="px-4 py-2 bg-gray-50">Player</th>
                                                <th className="px-4 py-2 bg-gray-50 text-right">Score</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100">
                                            {sessions.sort((a,b) => new Date(b.completedAt) - new Date(a.completedAt)).map((session, idx) => (
                                                <tr key={idx} className="hover:bg-gray-50/50">
                                                    <td className="px-4 py-2 text-gray-500 text-xs">
                                                        <div className="flex flex-col">
                                                            <span className="font-medium">{new Date(session.completedAt).toLocaleDateString()}</span>
                                                            <span className="text-gray-400">{new Date(session.completedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                                                        </div>
                                                    </td>
                                                    <td className="px-4 py-2 font-medium text-gray-800">
                                                        {session.username}
                                                    </td>
                                                    <td className="px-4 py-2 text-right">
                                                        <span className={`inline-block px-2 py-0.5 rounded text-xs font-bold ${
                                                            (session.score / session.totalQuestions) >= 0.7 
                                                            ? 'bg-green-100 text-green-700' 
                                                            : 'bg-indigo-50 text-indigo-700'
                                                        }`}>
                                                            {session.score}/{session.totalQuestions}
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        ))}
                    </div>
                }
              </div>

            </div>
          </div>
        );
      };

      const App = () => {
        const [config, setConfig] = useState(() => {
          const saved = localStorage.getItem('quiz-app-config');
          return saved ? JSON.parse(saved) : { appName: DEFAULT_APP_NAME };
        });
        const [quizzes, setQuizzes] = useState(() => {
          const saved = localStorage.getItem('quiz-app-data');
          return saved ? JSON.parse(saved) : [DEFAULT_QUIZ];
        });
        const [history, setHistory] = useState(() => {
          const saved = localStorage.getItem('quiz-app-history');
          return saved ? JSON.parse(saved) : [];
        });

        const [view, setView] = useState('welcome');
        const [currentUser, setCurrentUser] = useState('');
        const [selectedQuiz, setSelectedQuiz] = useState(null);
        const [lastSession, setLastSession] = useState(null);

        useEffect(() => { localStorage.setItem('quiz-app-config', JSON.stringify(config)); }, [config]);
        useEffect(() => { localStorage.setItem('quiz-app-data', JSON.stringify(quizzes)); }, [quizzes]);
        useEffect(() => { localStorage.setItem('quiz-app-history', JSON.stringify(history)); }, [history]);

        const handleStartQuiz = (quiz) => {
          if (!currentUser.trim()) { alert("Please enter your name first!"); return; }
          setSelectedQuiz(quiz);
          setView('quiz');
        };

        const handleQuizFinish = (session) => {
          setLastSession(session);
          setHistory(prev => [session, ...prev]);
          setView('result');
        };

        const handleAddQuiz = (quiz) => setQuizzes(prev => [...prev, quiz]);
        const handleDeleteQuiz = (id) => {
          if (confirm("Are you sure you want to delete this quiz?")) setQuizzes(prev => prev.filter(q => q.id !== id));
        };

        const renderWelcome = () => (
          <div className="flex flex-col items-center justify-center min-h-[80vh] w-full max-w-2xl mx-auto p-4 z-10">
            <div className="text-center mb-10">
              <h1 className="text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 mb-4 pb-2">{config.appName}</h1>
              <p className="text-gray-500 text-lg">Test your knowledge and challenge yourself.</p>
            </div>
            <div className="w-full bg-white rounded-3xl shadow-xl shadow-indigo-100 p-8 border border-gray-100">
              <div className="mb-8">
                <label className="block text-sm font-bold text-gray-700 mb-2 ml-1 uppercase tracking-wide">Enter Your Name</label>
                <div className="relative">
                  {User && <User className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" size={20} />}
                  <input type="text" placeholder="John Doe" value={currentUser} onChange={(e) => setCurrentUser(e.target.value)} className="w-full pl-12 pr-4 py-4 bg-gray-50 border-2 border-gray-100 rounded-xl focus:border-indigo-500 focus:bg-white focus:outline-none transition-all text-lg font-medium text-gray-800" />
                </div>
              </div>
              <div className="space-y-4">
                <h3 className="font-bold text-gray-800 text-lg">Select a Quiz</h3>
                {quizzes.length === 0 ? <div className="p-6 text-center bg-gray-50 rounded-xl border border-dashed border-gray-300"><p className="text-gray-500">No quizzes available. Ask admin to upload one.</p></div> : 
                  <div className="grid gap-3 max-h-64 overflow-y-auto pr-2 custom-scrollbar">
                    {quizzes.map(quiz => (
                      <button key={quiz.id} onClick={() => handleStartQuiz(quiz)} className="group flex items-center justify-between p-4 bg-white border border-gray-200 hover:border-indigo-500 hover:shadow-md rounded-xl transition-all text-left">
                        <div><h4 className="font-bold text-gray-800 group-hover:text-indigo-600 transition-colors">{quiz.title}</h4><span className="text-xs text-gray-400 font-medium">{quiz.questions.length} Questions</span></div>
                        <div className="w-10 h-10 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center group-hover:bg-indigo-600 group-hover:text-white transition-all">{Play && <Play size={20} className="ml-1" />}</div>
                      </button>
                    ))}
                  </div>
                }
              </div>
            </div>
            <div className="mt-8 flex gap-4">
              <button onClick={() => setView('admin')} className="text-gray-400 hover:text-gray-600 text-sm flex items-center gap-2 px-4 py-2 rounded-full hover:bg-gray-200 transition-colors">{Settings && <Settings size={16} />} Admin Panel</button>
            </div>
          </div>
        );

        const renderResult = () => {
          if (!lastSession) return null;
          const percentage = Math.round((lastSession.score / lastSession.totalQuestions) * 100);
          let message = "Keep Practicing!";
          let color = "text-yellow-600";
          if (percentage >= 90) { message = "Outstanding!"; color = "text-green-600"; }
          else if (percentage >= 70) { message = "Great Job!"; color = "text-indigo-600"; }
          else if (percentage >= 50) { message = "Good Effort!"; color = "text-blue-600"; }

          return (
            <div className="flex flex-col items-center justify-center min-h-[80vh] w-full animate-fade-in z-10">
              <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 text-center max-w-md w-full relative overflow-hidden">
                <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 to-purple-500" />
                <div className="mx-auto w-24 h-24 bg-yellow-50 rounded-full flex items-center justify-center mb-6 shadow-inner">{Trophy && <Trophy className="text-yellow-500 drop-shadow-sm" size={48} />}</div>
                <h2 className={`text-3xl font-extrabold mb-2 ${color}`}>{message}</h2>
                <p className="text-gray-500 mb-8">{lastSession.username}, here is your result for <br/><span className="font-semibold text-gray-800">{lastSession.quizTitle}</span></p>
                <div className="flex justify-center items-center gap-8 mb-10">
                  <div className="text-center"><div className="text-4xl font-bold text-gray-800">{lastSession.score}</div><div className="text-xs uppercase tracking-wide text-gray-400 font-bold mt-1">Correct</div></div>
                  <div className="h-12 w-px bg-gray-200"></div>
                  <div className="text-center"><div className="text-4xl font-bold text-gray-800">{lastSession.totalQuestions}</div><div className="text-xs uppercase tracking-wide text-gray-400 font-bold mt-1">Total</div></div>
                  <div className="h-12 w-px bg-gray-200"></div>
                  <div className="text-center"><div className="text-4xl font-bold text-indigo-600">{percentage}%</div><div className="text-xs uppercase tracking-wide text-gray-400 font-bold mt-1">Score</div></div>
                </div>
                <Button onClick={() => setView('welcome')} variant="secondary" fullWidth className="gap-2">{RotateCcw && <RotateCcw size={18} />} Back to Home</Button>
              </div>
            </div>
          );
        };

        return (
          <div className="min-h-screen bg-gray-50 text-gray-900 font-sans p-4 md:p-6 flex flex-col relative overflow-hidden">
            {/* Background Watermark - Rotated Center */}
            <div className="fixed inset-0 flex items-center justify-center pointer-events-none z-0 overflow-hidden">
                <div className="transform -rotate-12 select-none text-center opacity-[0.05]">
                    <div className="text-6xl md:text-8xl font-black text-gray-800 uppercase tracking-widest leading-none whitespace-nowrap">Created By</div>
                    <div className="text-3xl md:text-5xl font-bold text-gray-800 font-mono mt-4 tracking-wider">Manish Matwa @expert.py</div>
                </div>
            </div>

            {/* Bottom Watermark - Fixed Footer */}
            <div className="fixed bottom-0 left-0 right-0 p-6 flex flex-col items-center justify-end pointer-events-none select-none z-0 opacity-20">
                <div className="text-xl md:text-3xl font-black uppercase tracking-[0.2em] text-gray-800 text-center">
                    Created By Manish Matwa
                </div>
                <div className="text-sm md:text-lg font-mono font-bold text-indigo-900 mt-1">
                    @expert.py
                </div>
            </div>

            <main className="flex-grow flex flex-col items-center relative z-10 w-full">
              {view === 'welcome' && renderWelcome()}
              {view === 'quiz' && selectedQuiz && <div className="w-full mt-8 md:mt-12"><QuizPlayer quiz={selectedQuiz} username={currentUser} onFinish={handleQuizFinish} onExit={() => setView('welcome')} /></div>}
              {view === 'result' && renderResult()}
              {view === 'admin' && <div className="w-full mt-8"><AdminPanel appName={config.appName} quizzes={quizzes} history={history} onUpdateConfig={(newConfig) => setConfig(prev => ({ ...prev, ...newConfig }))} onAddQuiz={handleAddQuiz} onDeleteQuiz={handleDeleteQuiz} onBack={() => setView('welcome')} /></div>}
            </main>
            <footer className="mt-auto py-6 text-center text-gray-400 text-sm relative z-10"><p>&copy; {new Date().getFullYear()} {config.appName}. All rights reserved.</p></footer>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>